rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isSignedIn() {
      return request.auth != null;
    }
    function isOwner(uid) {
      return isSignedIn() && request.auth.uid == uid;
    }

    // Lock everything by default
    match /{document=**} {
      allow read, write: if false;
    }

    // User-scoped data
    match /users/{uid} {
      // Users can read/update their own root profile doc if you store one
      allow read, write: if isOwner(uid);

      // Shifts: users/{uid}/shifts/{shiftId}
      match /shifts/{shiftId} {
        allow read, list: if isOwner(uid);
        allow create, update, delete: if isOwner(uid)
          && request.resource.data.keys().hasAll(['ts'])
          && request.time.toMillis() >= 0; // trivial sanity, extend as needed
      }

      // (Optional) Transactions, Budgets, etc. uncomment when ready
      // match /transactions/{tid} {
      //   allow read, list, create, update, delete: if isOwner(uid);
      // }
      // match /budgets/{bid} {
      //   allow read, list, create, update, delete: if isOwner(uid);
      // }
    }
  }
}

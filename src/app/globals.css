
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base token palette (HSL numbers only; Tailwind uses hsl(var(--token))) */
:root.light, :root {
  --bg: 240 5% 96%;
  --fg: 220 15% 15%;
  --muted: 220 14% 96%;
  --muted-fg: 220 9% 35%;
  --card: 0 0% 100%;
  --card-fg: 220 15% 15%;
  --border: 220 13% 90%;
  --ring: 221 83% 53%;
  --primary: 250 90% 60%;
  --primary-fg: 210 40% 98%;
  --secondary: 262 83% 58%;
  --secondary-fg: 210 40% 98%;
  --accent: 180 100% 30%;
  --accent-fg: 210 40% 98%;
  --warning: 38 92% 50%;
  --danger: 0 72% 51%;
  --success: 146 50% 36%;
  --shadow: 240 10% 20%;
  --chart-bg: var(--card);
  --chart-fg: var(--card-fg);
  --chart-grid: 220 13% 88%;
  --chart-axis: 220 10% 35%;
  --chart-axis-weak: 220 10% 85%;
  --chart-1: 221 83% 53%;
  --chart-2: 173 58% 39%;
  --chart-3: 262 83% 58%;
  --chart-4: 38 92% 50%;
  --chart-5: 0 72% 51%;
  --glass-bg: hsl(var(--card) / 0.6);
  --glass-border: hsl(var(--border) / 0.5);
  --glass-highlight: hsl(var(--fg) / 0.06);
  --glass-shadow: 240 10% 20%;
  --glass-noise: rgba(255,255,255,0.05);
  --tooltip-bg: rgba(0,0,0,.72);
}

.dark {
  --bg: 220 15% 8%;
  --fg: 210 20% 95%;
  --muted: 220 12% 14%;
  --muted-fg: 220 8% 70%;
  --card: 220 14% 10%;
  --card-fg: 210 20% 95%;
  --border: 220 10% 22%;
  --ring: 221 83% 60%;
  --primary: 250 80% 65%;
  --primary-fg: 210 40% 98%;
  --secondary: 262 83% 65%;
  --secondary-fg: 210 40% 98%;
  --accent: 180 80% 40%;
  --accent-fg: 210 40% 98%;
  --warning: 38 92% 56%;
  --danger: 0 72% 60%;
  --success: 146 50% 42%;
  --shadow: 240 10% 5%;
  --chart-bg: var(--card);
  --chart-fg: var(--card-fg);
  --chart-grid: 220 10% 22%;
  --chart-axis: 220 8% 70%;
  --chart-axis-weak: 220 6% 30%;
  --chart-1: 221 83% 60%;
  --chart-2: 173 58% 45%;
  --chart-3: 262 83% 65%;
  --chart-4: 38 92% 56%;
  --chart-5: 0 72% 60%;
  --glass-bg: hsl(var(--card) / 0.25);
  --glass-border: hsl(var(--border) / 0.45);
  --glass-highlight: hsl(var(--fg) / 0.08);
  --glass-shadow: 240 10% 5%;
  --glass-noise: rgba(255,255,255,0.03);
  --tooltip-bg: rgba(20,20,24,.72);
}

/* High-contrast theme favors near-AAA text contrast */
.hc {
  --bg: 0 0% 100%;
  --fg: 0 0% 7%;
  --muted: 0 0% 98%;
  --muted-fg: 0 0% 15%;
  --card: 0 0% 100%;
  --card-fg: 0 0% 7%;
  --border: 0 0% 15%;
  --ring: 230 100% 40%;
  --primary: 230 100% 30%;
  --primary-fg: 0 0% 100%;
  --secondary: 270 100% 35%;
  --secondary-fg: 0 0% 100%;
  --accent: 160 100% 25%;
  --accent-fg: 0 0% 100%;
  --warning: 40 100% 35%;
  --danger: 0 100% 35%;
  --success: 140 100% 22%;
  --shadow: 0 0% 0%;
  --chart-bg: var(--card);
  --chart-fg: var(--card-fg);
  --chart-grid: 0 0% 20%;
  --chart-axis: 0 0% 7%;
  --chart-axis-weak: 0 0% 35%;
  --chart-1: 230 100% 30%;
  --chart-2: 160 100% 25%;
  --chart-3: 270 100% 35%;
  --chart-4: 40 100% 35%;
  --chart-5: 0 100% 35%;
  --glass-bg: hsl(var(--card));
  --glass-border: hsl(var(--border));
  --glass-noise: transparent;
}

@layer base {
  :root {
    --background: hsl(var(--bg));
    --foreground: hsl(var(--fg));
    --card: hsl(var(--card));
    --card-foreground: hsl(var(--card-fg));
    --popover: hsl(var(--card));
    --popover-foreground: hsl(var(--card-fg));
    --primary: hsl(var(--primary));
    --primary-foreground: hsl(var(--primary-fg));
    --secondary: hsl(var(--secondary));
    --secondary-foreground: hsl(var(--secondary-fg));
    --muted: hsl(var(--muted));
    --muted-foreground: hsl(var(--muted-fg));
    --accent: hsl(var(--accent));
    --accent-foreground: hsl(var(--accent-fg));
    --destructive: hsl(var(--danger));
    --destructive-foreground: hsl(var(--primary-fg));
    --border: hsl(var(--border));
    --input: hsl(var(--border));
    --ring: hsl(var(--ring));
    --radius: 0.5rem;
    --chart-1: hsl(var(--chart-1));
    --chart-2: hsl(var(--chart-2));
    --chart-3: hsl(var(--chart-3));
    --chart-4: hsl(var(--chart-4));
    --chart-5: hsl(var(--chart-5));
  }

  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Utilities */
:root { color-scheme: light dark; }
* { outline-color: hsl(var(--ring)); }

/***** Motion *****/
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; scroll-behavior: auto !important; }
}

[data-density="compact"] {
  --space-1: .25rem; --space-2: .375rem; --space-3: .5rem;
}
[data-density="comfy"] {
  --space-1: .375rem; --space-2: .5rem; --space-3: .75rem;
}

.recharts-default-tooltip {
  background: hsl(var(--chart-bg)) !important;
  border: 1px solid hsl(var(--border)) !important;
  color: hsl(var(--chart-fg)) !important;
}

.glass {
    position: relative;
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 1rem;
    -webkit-backdrop-filter: blur(16px) saturate(1.15);
    backdrop-filter: blur(16px) saturate(1.15);
    box-shadow:
      0 1px 0 var(--glass-highlight) inset,
      0 8px 30px hsl(var(--glass-shadow) / 0.15);
    overflow: clip;
    isolation: isolate;
  }
  .glass::after {
    content: "";
    position: absolute; inset: 0;
    pointer-events: none;
    background-image:
      radial-gradient(120% 80% at 50% -20%, rgba(255,255,255,0.08), transparent 60%),
      url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'></feColorMatrix><feComponentTransfer><feFuncA type='linear' slope='0.05'/></feComponentTransfer></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
    background-size: 100% 100%, 120px 120px;
    mix-blend-mode: soft-light;
    opacity: 0.6;
  }
  @supports not ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
    .glass {
      background: hsl(var(--card));
      box-shadow: 0 1px 0 var(--glass-highlight) inset, 0 8px 24px hsl(var(--glass-shadow) / 0.1);
    }
    .glass::after { opacity: 0.1; }
  }

  .glass-sm { -webkit-backdrop-filter: blur(10px) saturate(1.05); backdrop-filter: blur(10px) saturate(1.05); }
  .glass-lg { -webkit-backdrop-filter: blur(22px) saturate(1.2);  backdrop-filter: blur(22px) saturate(1.2);  }
  .glass-border-strong { border-color: hsl(var(--border) / 0.65); }

@layer components {
    .btn {
        @apply transition-transform duration-100 ease-in-out;
    }
    .btn:active {
        @apply scale-[0.98];
    }
}

/* Focus ring thickness tuned for HC */
:root { --ring-w: 2px; }
.hc { --ring-w: 3px; }
:where(button, [role="button"], a, input, select, textarea):focus-visible {
  outline: var(--ring-w) solid hsl(var(--ring));
  outline-offset: 2px;
}
/* Card content spacing helpers */
.card-pad { padding: clamp(0.75rem, 1.2vw, 1rem); }

/* Reduced transparency: auto-disable glass if user prefers reduced motion */
@media (prefers-reduced-motion: reduce) {
  :root:not(.hc) [data-glass="auto"] .glass {
    -webkit-backdrop-filter: none; backdrop-filter: none;
    background: hsl(var(--card));
    box-shadow: 0 1px 0 hsl(var(--shadow) / 0.06) inset, 0 8px 24px hsl(var(--shadow) / 0.1);
  }
}
/* Manual override (Appearance page sets data-glass="on|off|auto" on <html>) */
[data-glass="off"] .glass { -webkit-backdrop-filter:none; backdrop-filter:none; background:hsl(var(--card)); box-shadow:0 1px 0 hsl(var(--shadow)/.06) inset, 0 8px 24px hsl(var(--shadow)/.1); }

.kbd { background:hsl(var(--muted)); padding:.125rem .375rem; border-radius:.375rem; border:1px solid hsl(var(--border)); font-size:.75rem }

:root {
  --motion-fast: 120ms;
  --motion-med: 220ms;
  --motion-slow: 360ms;
}
.motion-quiet * { transition-duration: 0ms !important; animation-duration: 0ms !important; }
.motion-smooth * { transition-duration: var(--motion-med); }

/******** GPU & glass safety ********/
.gpu { will-change: transform, opacity; transform: translateZ(0); }
.glass { background: color-mix(in oklab, hsl(var(--bg)) 80%, transparent); backdrop-filter: blur(8px); }
/* Avoid heavier blur on hover; only light transform */
.card { transition: transform var(--motion-med); }
.card:hover { transform: translateY(-2px) scale(1.01); }

/* text & surface */
:root {
  --bg: #0b0b10;
  --surface: rgba(255,255,255,0.04);
  --text: #e9e9ef;
  --muted: #9aa0a6;
  /* chart palette */
  --ch-1: #7cc6ff; /* inflow */
  --ch-2: #ff9aa2; /* outflow */
  --ch-3: #ffd166; /* accent */
  --ch-grid: rgba(255,255,255,0.08);
}

:root.light {
  --bg: #ffffff;
  --surface: rgba(0,0,0,0.04);
  --text: #111827;
  --muted: #4b5563;
  --ch-1: #2563eb;
  --ch-2: #ef4444;
  --ch-3: #f59e0b;
  --ch-grid: rgba(0,0,0,0.06);
}

.glass { backdrop-filter: saturate(160%) blur(16px); background: var(--surface); }
.text-base { color: var(--text); }
.text-muted { color: var(--muted); }

/* Recharts defaults alignment */
.recharts-text { fill: var(--muted); }
.recharts-cartesian-grid-horizontal line,
.recharts-cartesian-grid-vertical line { stroke: var(--ch-grid); }
